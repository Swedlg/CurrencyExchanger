# **CurrencyExchanger**

Проект для получения истории значений курсов валют с сервиса ЦБ

---

Проект представляет собой микросервисную архитектуру с 3 решениями:

- **Crawler**. Web Api проект для выгрузки информации о валютных котировках с api центробанка.
- **Converter**. Hosted Service (Worker) проект для вычисления курсов валют относительно друг друга (т.к. в API центробанка курсы валют только относительно рубля).
- **Storage**. Web Api проект для получения выборок по валютным котировкам по датам, а также содержит репозиторий хранения различной информации о валютах.

Также присутствует еще одно решение - **ExchangeData** - Библиотека с DTO моделями для их передачи между микросервисами с использованием **RabbitMQ** и **MassTransit**. Я выложил ее на NuGet.

---

Для создания задач (в том числе и повторяемых) использовалась библиотека **Hangfire**.

---

Для передачи DTO между микросервисами использовалсь модель *Publicher/Subscriber*

Очень обобщенное представление о потоках информации на картине:

![Тут должна была быть картинка со схемой](https://i.ibb.co/f2PwN9F/fsdfdsd.png)

DTO модели:

- **CurrencyInfoListDTO** - справочная информация о валютах

- **RubleQuotesByDateDTO** - котировки валют по датам относительно рубля

- **CurrencyQuotesByDateListDTO** - котировки валют по датам относительно друг друга, а не только относительно рубля

Базы Данных:

- **CurrencyNotificationServiceDb** - База данных для хранения задач Hangfire и даз загрузок валют

- **CurrencyStorageDb** - База данных для хранения справочной информации о валютах и информации о валютных котировках по датам

Строки подключения к БД и RabbitMQ передаются через окружение. Их можно посмотреть в docker-compose файле.

При создании котнейнеров я использую один контейнер Postgres для создания обеих БД.

Для отправки запросов через Postman можно использовать следующие команды:
<font color="#808080">(:exclamation: Пока только по HTTP)</font>

1) POST Для создания **единичной** задачи, получения справочной информации о валютах и валютных котировках по датам с последующей отправкой в Storage или Converter соответсвенно:
<font color="#808080">(:exclamation: При повторном создании задачи убедитесь, что таблица в бд с датами загрузок очищена п.3.)</font>
http://localhost:7049/api/hangfirejob/get-currencies-fire-and-forget

2) POST Для создания **повторяющейся** задачи, получения справочной информации о валютах и валютных котировках по датам с последующей отправкой в Storage или Converter соответсвенно:
<font color="#808080">(:exclamation: При повторном создании задачи убедитесь, что таблица в бд с датами загрузок очищена п.3.)</font>
http://localhost:7049/api/hangfirejob/get-currencies-recurring

3) DELETE Для очистки таблицы БД от информации о последних датах загрузки:
http://localhost:7049/api/UploadDate/truncate

4) GET Для получения напрямую в формате JSON справочной информации о валютах:
http://localhost:7049/api/currency/get-currencies

5) GET Для получения напрямую в формате JSON информации о валютных котировках по датe:
http://localhost:7049/api/currency/get-currencies-by-date?date=2023-09-30

6) GET Для получения из Storage справочной информации о валютах.
http://localhost:7036/api/Currency/get-currencies-infos

7) GET Для получения из Storage выборки по диапазону дат и вылютам:
http://localhost:7036/api/Currency/get-currencies-values?dateFrom=2023-09-30&dateTo=2023-10-30&baseRId=R00000&otherRid

8) DELETE Для очистки в БД таблицы со справочной информацией о валютах:
https://localhost:7036/api/Currency/truncate-currency-infos-db

9) FELETE Для очистки в БД таблицы с информацией о валютных котировках по датам:
https://localhost:7036/api/Currency/truncate-currency-values-db

P.S. При попытке подключиться к RabbitMQ контейнеру через браузер (например по http://localhost:15672/#/users) может ничего не произойти. У меня всегда работает с Firefox, но с Chrome срабатывает почему-то через раз. Возможно вам нужно будет сделать жесткую перезагрузку страницы.